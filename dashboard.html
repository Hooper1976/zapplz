<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dashboard - ZAPPLZ</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background: radial-gradient(circle at center, #063c2c 0%, var(--bg-deep) 70%);
            min-height: 100vh;
        }
        .hero-banner {
            position: relative; width: 100%; height: 180px;
            display: flex; align-items: center; justify-content: center;
            padding: 20px; box-sizing: border-box;
            background: transparent;
        }
        .main-bg-logo {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 300px; height: 300px; opacity: 0.05; z-index: -1; pointer-events: none;
        }
        .stats-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: -30px 20px 20px;
            position: relative; z-index: 10;
        }
        .stat-card {
            background: var(--bg-card); border: 1px solid var(--border);
            padding: 15px; border-radius: 16px; text-align: center;
        }
        .stat-val { font-size: 1.4rem; font-weight: 900; color: var(--primary); display: block; }
        .stat-lbl { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1px; opacity: 0.6; }

        .action-card {
            display: flex; align-items: center; gap: 15px; text-decoration: none; color: inherit;
            background: var(--bg-card); border: 1px solid var(--border); margin: 0 20px 12px;
            padding: 15px; border-radius: 18px; transition: transform 0.2s;
        }
        .action-card:active { transform: scale(0.97); }
        .action-icon { 
            width: 50px; height: 50px; border-radius: 12px; 
            display: flex; align-items: center; justify-content: center;
            font-size: 20px; color: white; background-size: cover;
        }
        .action-card h3 { margin: 0; font-size: 1rem; color: white; text-transform: uppercase; }
        .action-card p { margin: 3px 0 0; font-size: 0.75rem; color: var(--primary); font-weight: 600; }
    </style>
</head>
<body>

    <div class="main-bg-logo">
        <img src="logo.png" style="width: 100%; height: 100%; object-fit: contain;">
    </div>

    <div class="hero-banner">
        <div style="text-align: center;">
            <h2 style="font-size: 1.8rem; font-weight: 900; margin: 0; text-transform: uppercase; color: var(--primary);">ZAPP<span>LZ</span></h2>
            <p style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;" id="welcomeName">BEREIT FÜR DEINE NÄCHSTE ACTION?</p>
        </div>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-val" id="xpCount">0</span>
            <span class="stat-lbl">Gesamt XP</span>
        </div>
        <div class="stat-card">
            <span class="stat-val" id="rankPos">#--</span>
            <span class="stat-lbl">Ranking</span>
        </div>
    </div>

    <div class="section-label">Was willst du tun?</div>

    <a href="quests_global.html" class="action-card">
        <div class="action-icon" style="background-image: url('https://images.unsplash.com/photo-1551632811-561732d1e306?auto=format&fit=crop&w=100&q=80')"></div>
        <div>
            <h3>Welt-Quests</h3>
            <p>Verdiene XP & Medaillen</p>
        </div>
    </a>

    <a href="quests_private.html" class="action-card">
        <div class="action-icon" style="background-image: url('https://images.unsplash.com/photo-1528605248644-14dd04cb113d?auto=format&fit=crop&w=100&q=80')"></div>
        <div>
            <h3>Herausforderungen</h3>
            <p>Besiege deine Freunde</p>
        </div>
    </a>

    <a href="ranking.html" class="action-card">
        <div class="action-icon" style="background: #1e40af; border: 1px solid rgba(255,255,255,0.1)">
            <i class="fas fa-trophy"></i>
        </div>
        <div>
            <h3>Bestenliste</h3>
            <p>Wer führt in der Stadt?</p>
        </div>
    </a>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/shared_nav.js"></script>
    <script>
        const sup = window.supabase.createClient("https://oxwpqwnhabldvfsujmvx.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im94d3Bxd25oYWJsZHZmc3VqbXZ4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NTMzMDQsImV4cCI6MjA4NzQyOTMwNH0.ZDz0Pctbp9oq45QF8_4ObizhQfxglrGw9H0dhguHj5A");
        
        async function loadDashboard() {
            injectHeader("ZAPPLZ");
            injectBottomNav("home");

            const { data: { session } } = await sup.auth.getSession();
            if(!session) return window.location.href = 'login.html';

            const { data: prof } = await sup.from('profiles').select('*').eq('id', session.user.id).single();
            if(prof) {
                document.getElementById('welcomeName').innerText = "Bereit, " + prof.username + "?";
                document.getElementById('xpCount').innerText = (prof.total_points || 0).toLocaleString();
            }
        }
        loadDashboard();
    </script>
</body>
</html>
